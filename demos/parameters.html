<style type="text/css">
    *[data-tmpl], .html-template {   
    	display:none;    
    }
    .peopleTable td { border:2px solid #555; text-align:center; }   
    .person{ background-color:#AFA; }   
    .personAlt{ background-color:#9ED; }   
    .personSeparator { background-color:#C77; height:6px;}   
    .citySeparator { background-color:#CCC; height:4px;}   
    .peopleTable { border-collapse:collapse; border:2px solid #555; }   
</style>

<script src="http://code.jquery.com/jquery.js"></script>
<script src="../jquery.tmpl.js"></script>
<script>
$(function(){
	var people = [
		{
			firstName: "John",
			lastName: "Resig",
			url: "http://ejohn.org/",
			cities: [ "BSTN", "NY", "SF" ],
			favoriteCity: 0
		},
		{
			firstName: "Dave",
			lastName: "Reed",
			url: "http://dave.org/",
			cities: [ "RDMD", "STL", "SF", "LA" ],
			favoriteCity: 3,
			invertName: true
		},
		{
			firstName: "Boris",
			lastName: "Moore",
			url: "http://boris.org/",
			cities: [ "RDMD" ],
			favoriteCity: 0,
			invertName: true
		}
	];
	
	var cities = {
		BSTN: { name: "Boston", state: "MA", weather: "Cold", averageTemp: 30 },
		SF: { name: "San Francisco", state: "CA", weather: "Hot", averageTemp: 70 },
		STL: { name: "Seattle", state: "WA", weather: "Wet", averageTemp: 60 },
		RDMD: { name: "Redmond", state: "WA", weather: "Wet", averageTemp: 60 },
		LA: { name: "Los Angeles", state: "CA", weather: "Hot", averageTemp: 90 },
		NY: { name: "New York", state: "NY", weather: "Variable", averageTemp: 50 }
	};

	$(".peopleTable")
		.append("#tmplPeople", people, {cities: cities} );
});

function getName( context, person ) {
	return person.invertName ? "<b>" + person.lastName + "</b>, " + person.firstName : person.firstName + " " + person.lastName;
}

function getCity( context, index ) {
	return context.options.cities[this.cities[index]];
}

function getTemplate( context, key ) {
	return $.tmpl("#tmpl" + key);
}

function cityRendered( nodes, context ) {
	$("input", nodes)
		.animate({"width":"+=" + (context.data.averageTemp - 50)}, 2000)
		.click(function(){ 
			alert(context.data.weather) 
		});
}

</script>

<script id="tmplPeople" type="text/html">
	{{render(
		getCity(favoriteCity), 
		{ 
			owner: this, 
			title: "Favorite city for",
			rendered: cityRendered }
	) 
	getTemplate("City")}}
</script>

<script id="tmplCity" type="text/html">
	<tr class="person${$context.parent.index%2?'Alt':''}">
		<td>${$options.title} ${getName($options.owner)} </td>
		<td><b>${name}</b></td><td>${state}</td>
		<td><input type="button" value="Local Weather?"/></td>
	</tr>
</script>

<table class="peopleTable"><tbody>
</tbody></table>
