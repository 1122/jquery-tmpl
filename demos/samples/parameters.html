<style type="text/css">
	*[data-tmpl], .html-template {   
		display:none;    
	}
	.citiesTable td { border:2px solid #555; text-align:left; padding:3px; }   
	.row{ background-color:#AFA; }   
	.rowAlt{ background-color:#9ED; }   
	.citiesTable { border-collapse:collapse; border:2px solid #555; margin:10px }   
	#allCitiesBtn { margin:10px }
	.center td { text-align:center; }   
</style>

<script src="http://code.jquery.com/jquery.js"></script>
<script src="../../jquery.tmpl.js" type="text/javascript"></script>
<script>
$(function(){
	$("#favoriteCities")
		.append("#tmplFavorites", people, {allCities: allCities} );

	$("#allCitiesBtn").click(function() {  
		$("#allCities")
			.empty()
			.append("#tmplAll", people, {
				allCities: allCities 
			});
	});
});

var people = [
	{
		firstName: "John",
		lastName: "Resig",
		url: "http://ejohn.org/",
		cities: [ "BSTN", "NY", "SF" ],
		favoriteCity: 0
	},
	{
		firstName: "Dave",
		lastName: "Reed",
		url: "http://dave.org/",
		cities: [ "RDMD", "STL", "SF", "LA" ],
		favoriteCity: 3,
		invertName: true
	},
	{
		firstName: "Boris",
		lastName: "Moore",
		url: "http://boris.org/",
		cities: [ "RDMD" ],
		favoriteCity: 0,
		invertName: true
	}
];

var allCities = {
	BSTN: { name: "Boston", state: "MA", weather: "Cold", averageTemp: 30 },
	SF: { name: "San Francisco", state: "CA", weather: "Hot", averageTemp: 70 },
	STL: { name: "Seattle", state: "WA", weather: "Wet", averageTemp: 60 },
	RDMD: { name: "Redmond", state: "WA", weather: "Wet", averageTemp: 60 },
	LA: { name: "Los Angeles", state: "CA", weather: "Hot", averageTemp: 95 },
	NY: { name: "New York", state: "NY", weather: "Variable", averageTemp: 50 }
};

function getName() {
	return this.data.invertName ? "<b>" + this.data.lastName + "</b>, " + this.data.firstName : this.data.firstName + " " + this.data.lastName;
}

function getCity( index ) {
	return this.allCities[this.data.cities[index]];
}

function getCities( cities ) {
	return $.map(cities, function(index) { 
		return this.allCities[index]; 
	});
}

function getTemplate( key ) {
	return $.tmpl("#tmpl" + key);
}

function cityRendered( ctx ) {
	$(".temperature", this.nodes)
		.animate({"width":"+=" + (this.data.averageTemp*2 - 50)}, 2000)
		.click(function(){ 
			alert(ctx.data.averageTemp); 
		});
}

function alternate() {
	return ($.inArray( this.data, people ) % 2) ? "rowAlt" : "row";
}

$( ".weather" ).live( "click", function() {
	var ctx = $.tmpl(this);
	alert(ctx.data.weather); 
});

</script>

<script id="tmplFavorites" type="text/html">
	{{tmpl(
		getCity(favoriteCity), 
		{ 
			owner: this, 
			title: "Favorite city for",
			rendered: cityRendered 
		}
	) 
	getTemplate("City")}}
</script>

<script id="tmplAll" type="text/html">
	<tr class="${alternate()} center"><td colspan="4">Cities for ${getName()}</td></tr>
	{{tmpl(
		getCities(cities), 
		{ 
			rendered: cityRendered 
		}
	) 
	getTemplate("City")}}
</script>

<script id="tmplCity" type="text/html">
	<tr class="row${alternate()}">
		{{if owner}}
			<td>${this.title} ${getName(this.owner)} </td>
		{{/if}}
		<td><b>${name}</b>
		</td><td>${state}</td>
		<td><input type="button" value="Local Weather" class="weather"/></td>
		<td width="320px"><input type="button" value="Local Temperature" class="temperature"/></td>
	</tr>
</script>

<table id="favoriteCities" class="citiesTable"></table>

<input id="allCitiesBtn" type="button" value="All cities" /> 
<table id="allCities" class="citiesTable"></table>

