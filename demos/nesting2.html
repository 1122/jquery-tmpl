<style type="text/css">
    *[data-tmpl], .html-template {   
    	display:none;    
    }
    .peopleTable td { border:2px solid #555; text-align:center; }   
    .person{ background-color:#AFA; }   
    .personAlt{ background-color:#9ED; }   
    .personSeparator { background-color:#C77; height:6px;}   
    .citySeparator { background-color:#CCC; height:4px;}   
    .peopleTable { border-collapse:collapse; border:2px solid #555; }   
</style>

<script src="http://code.jquery.com/jquery.js"></script>
<script src="../jquery.tmpl.js"></script>
<script>
$(function(){
	var people = [
		{
			firstName: "John",
			lastName: "Resig",
			url: "http://ejohn.org/",
			cities: [ "BSTN", "NY", "SF" ]
		},
		{
			firstName: "Dave",
			lastName: "Reed",
			url: "http://dave.org/",
			cities: [ "RDMD", "STL", "SF", "LA" ]
		},
		{
			firstName: "Boris",
			lastName: "Moore",
			url: "http://boris.org/",
			cities: [ "RDMD" ]
		}
	];
	
	var allCities = {
		BSTN: { name: "Boston", state: "MA", weather: "Cold" },
		SF: { name: "San Francisco", state: "CA", weather: "Warm" },
		STL: { name: "Seattle", state: "WA", weather: "Wet" },
		RDMD: { name: "Redmond", state: "WA", weather: "Wet" },
		LA: { name: "Los Angeles", state: "CA", weather: "Hot" },
		NY: { name: "New York", state: "NY", weather: "Variable" }
	};

	$(".peopleTable")
		.append("#tmplPeople", people, {allCities: allCities} );

});

function getName( context ) {
	return this.firstName + " " + this.lastName;
}

function getCities( context, begin, end ) {
	return $.map(this.cities.slice(begin, end), function(city) {
		return context.allCities[city];
	});
}

function getCityCount( context, begin, end ) {
	return this.cities.slice(begin, end).length;
}

function alternate( context ) {
	return (context.dataIndex() % 2) ? "personAlt" : "person";
}

var startIndex = 1, endIndex = 3;
</script>

<script id="tmplPeople" type="text/html">
	<tr class="${alternate()}"><td colspan="2"><a href="${url}">${getName()}</a></td></tr>
	<tr class="personSeparator"><td colspan="2"></td></tr>
	{{if getCityCount(startIndex, endIndex)}}
		<tr class="${alternate()}"><td colspan="2"><i>Favorite Cities</i></td></tr>
		{{each getCities(startIndex, endIndex)}}
			<tr class="citySeparator"><td colspan="2"></td></tr>
			<tr class="${alternate()}"><td><b>${name}</b></td><td>${state}</td></tr>
			<tr class="${alternate()}"><td colspan="2"><i>${weather}...</i></td></tr>
		{{/each}}
		<tr class="personSeparator"><td colspan="2"></td></tr>
	{{/if}}
</script>

<table class="peopleTable"><tbody>
	<tr class="personSeparator"><td colspan="2"></td></tr>
</tbody></table>

