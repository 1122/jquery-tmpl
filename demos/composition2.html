<style type="text/css">
    *[data-tmpl], .html-template {   
    	display:none;    
    }
    .peopleTable td { border:2px solid #555; text-align:center; }   
    .person{ background-color:#AFA; }   
    .personAlt{ background-color:#9ED; }   
    .personSeparator { background-color:#C77; height:6px;}   
    .citySeparator { background-color:#CCC; height:4px;}   
    .peopleTable { border-collapse:collapse; border:2px solid #555; }   
</style>

<script src="http://code.jquery.com/jquery.js"></script>
<script src="../jquery.tmpl.js"></script>
<script>
var people = [
	{
		firstName: "John",
		lastName: "Resig",
		url: "http://ejohn.org/",
		cities: [
			{ name: "Boston", state: "MA" },
			{ name: "San Francisco", state: "CA" }
		]
	},
	{
		firstName: "Dave",
		lastName: "Reed",
		url: "http://dave.org/"
	},
	{
		firstName: "Boris",
		lastName: "Moore",
		url: "http://boris.org/",
		cities: [
			{ name: "Redmond", state: "WA" },
			{ name: "Seattle", state: "WA" },
			{ name: "New York", state: "NY" }
		]
	}
];

function getName() {
	return this.data.firstName + " " + this.data.lastName;
}
         
function alternate( item, array ) {
	return ($.inArray( item, array ) % 2) ? "personAlt" : "person";
}

function cityNumber() {
	return $.inArray( this.data, this.parent.data.cities ) + 1;
}

function getTemplate( key ) {
	return $.tmpl("#tmpl" + key);
}


$(function(){
	$(".peopleTable")
		.append("#tmplPeople", people );
});
</script>

<script id="tmplPeople" type="text/html">
	<tr class="${alternate(this.data, people)}"><td colspan="2"><a href="${url}">${getName()}</a></td></tr>
	{{if cities}}
		{{tmpl(cities) getTemplate("City")}}
	{{/if}}
	<tr class="personSeparator"><td colspan="2"></td></tr>
</script>

<script id="tmplCity" type="text/html">
	<tr class="citySeparator"><td colspan="2"></td></tr>
	<tr class="${alternate(this.parent.data, people)}"><td colspan="2"><b><i>City ${cityNumber()}:</i></b></td></tr>
	<tr class="${alternate(this.parent.data, people)}"><td><b>${name}</b></td><td>${state}</td></tr>
</script>

<table class="peopleTable"><tbody>
	<tr class="personSeparator"><td colspan="2"></td></tr>
</tbody></table>

